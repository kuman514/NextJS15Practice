# 배포 환경
- `npm run build` 또는 `yarn build` 등의 빌드 명령어를 통해 최적화된 프로덕션 환경을 구축한다.
- 빌드로 구축한 배포 환경을 `npm run start` 또는 `yarn start`를 통해 테스트해본다.

## 배포 환경을 구축했을 때 일어나는 현상
- `npm run build`를 실행하면, 실제로 앱에서 사전 생성될 수 있는 모든 페이지를 모두 미리 렌더링하고 생성하기 때문에, 동적 페이지가 아니게 된다.
  - 즉, 빌드 과정에서 페이지에 해당하는 모든 데이터를 불러오고 렌더링한다. 사전에 생성되었고 캐싱되었기 때문에, 서버 컴포넌트가 다시 실행되지 않는다.
  - 이렇게 함으로써, 배포된 직후부터 모든 페이지가 작동하게 되어, 웹사이트의 가장 첫 방문자들도 데이터를 기다리지 않고 즉시 완성된 페이지의 내용을 볼 수 있게 된다.
- 이는 분명 사용자에게 좋은 경험을 제공해주긴 하지만, 데이터를 다시 가져오지 않는다는 단점이 있다.
  - 즉, 아무리 다시 방문해도 데이터를 다시 가져오는 대신 사전에 생성된 페이지를 그냥 사용한다.
  - 페이지에서 보이는 데이터에 변화가 있을 경우 이는 큰 문제가 된다.
- 이를 어떻게 대처해야 하는가?
  - `next/cache` 패키지의 `revalidatePath` 함수를 사용한다.
  - `revalidatePath` 함수는 특정 경로에 속하는 캐시의 유효성을 재검사한다.
  - 이 때, 두 번째 인자의 기본값(`'page'`)으로 명시된 경로만 검사되며, 하위 페이지(Nested Path)는 검사되지 않는다.
    - 하위 페이지까지 검사하고 싶다면, 두 번째 인자로 `'layout'`을 명시한다.
  - 예: `/meals` 페이지에 변화하는 데이터가 포함되어 있을 때, 데이터에 변화를 줄 때마다 `revalidatePath('/meals')`를 호출하면, `/meals` 페이지에 대한 캐시 유효성을 재검사한다.
