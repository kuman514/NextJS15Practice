# 인증의 작동 원리
- 사용자가 로그인을 한다.
  - 사용자가 입력한 이메일과 비밀번호가 유효한지 확인하고
  - 해당 사용자가 계정 생성 시 입력했던 정보와 일치한지 확인한다.
- 보호된 리소스에 대한 사용자의 접근을 허용시킨다.
  - 로그인으로 유효한 자격 증명이 확인된 사용자가 인증된 점을 기억하고 보호된 리소스에 접근할 수 있게 만든다.
  - 보호된 특정 리소스를 인증된 사용자만 접근할 수 있도록 한다.
  - 로그인이 완료되었고 인증된 표시가 있는 사용자만이 접근할 수 있어야 한다.

## 로그인
- 클라이언트, 즉 웹사이트에 사용자가 방문해 서버에 요청을 보낸다.
  - 인증 양식에 맞춰 새로운 사용자를 생성하거나 기존에 있던 사용자로 인증하는 요청을 보낸다.
  - 양식을 제출하면 요청과 함께 몇가지 인증 정보(이메일, 비밀번호 등등)가 서버로 전송된다.
- 서버는 이 요청과 양식을 받아 인증 정보를 확인한다.
  - 계정 생성 시, 이메일과 비밀번호가 Valid한지, 사용자가 아직 존재하지 않는지 확인하거나
  - 로그인 시, 데이터베이스에 저장된 기존 사용자들을 살펴보고, 사용자가 제출한 이메일과 비밀번호의 조합이 유효한지 확인한다
- 사용자가 올바른 자격 증명을 제출했다고 서버가 판단하면, 인증 세션을 생성한다.
  - 세션은 서버의 전용 테이블에 저장된 데이터베이스 항목을 말한다.
  - 특정 사용자가 인증되었다는 판단을 이 세션을 통해서 기억한다.
- 서버가 세션 ID를 생성하여 (일반적으로) 쿠키 형식으로 사용자에게 전달한다.
  - 요청한 자격 증명이 유효할 경우 (즉, 로그인 요청이 성공적일 경우), 요청을 보낸 사용자에 대한 응답으로 세션 ID가 포함된 쿠키를 보낸다.
- 클라이언트는 수신한 쿠키를 자동으로 세션 쿠키를 저장한다.

## 보호된 리소스 접근
- 로그인을 통해 쿠키를 가진 사용자가 보호되어야 할 경로에 대한 요청을 보낸다.
  - 이 때, 브라우저가 웹사이트에 딸린 쿠키를 자동으로 요청에 추가한다.
  - 즉, 세션 쿠키도 자동으로 요청에 첨부되며 서버로 전송되어진다.
- 서버에서 세션 쿠키를 확인하여 유효성을 검증한다.
  - 세션 ID가 유효하다면, 서버에서도 해당 세션에 대한 DB가 있을 것이다.
  - 따라서, 세션 ID는 단순한 숫자가 아닌, 쉽게 만들어낼 수 없는 복잡한 문자열이어야 한다.
- 유효한 활성 세션 쿠키를 포함한 요청을 받았다고 판단되었다면, 요청받은 리소스를 사용자에게 전달한다.
- 유효하지 않은 세션 쿠키 (비정상 쿠키거나 세션이 만료된 쿠키 등등) 수신 시 에러를 보낸다.